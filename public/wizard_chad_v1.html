<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WIZARDCHAD™ // BETA v1.0</title>
  <link rel="icon" type="image/png" href="./assets/icons/favicon_blue.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg-0: #060d1a;
      --bg-1: #020812;
      --panel: rgba(3, 10, 22, 0.82);
      --panel-2: rgba(7, 20, 40, 0.72);
      --line: rgba(68, 190, 255, 0.24);
      --line-strong: rgba(107, 208, 255, 0.48);
      --text-0: #d8eeff;
      --text-1: #9ec8ff;
      --accent-a: #00b7ff;
      --accent-b: #00e9ff;
      --cyan: #22fff3;
      --magenta: #ff2ec9;
      --red: #ff5a5a;
      --bubble: linear-gradient(120deg, #0a5fa5 0%, #0087ce 55%, #3dbbff 100%);
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      height: 100%;
    }

    html.invert-mode {
      filter: invert(1) hue-rotate(180deg);
    }

    body {
      margin: 0;
      min-height: 100dvh;
      font-family: "Share Tech Mono", monospace;
      color: var(--text-0);
      background:
        radial-gradient(800px 500px at 70% 20%, rgba(0, 153, 255, 0.09), transparent 64%),
        radial-gradient(880px 520px at 20% 90%, rgba(0, 210, 255, 0.07), transparent 64%),
        linear-gradient(180deg, #060d1a 0%, #050a14 32%, #020510 100%);
      overflow: hidden;
      display: grid;
      place-items: center;
      padding: 0;
      isolation: isolate;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background:
        repeating-linear-gradient(
          0deg,
          rgba(100, 190, 255, 0.04) 0px,
          rgba(100, 190, 255, 0.04) 1px,
          transparent 1px,
          transparent 3px
        ),
        repeating-linear-gradient(
          90deg,
          rgba(100, 190, 255, 0.03) 0px,
          rgba(100, 190, 255, 0.03) 1px,
          transparent 1px,
          transparent 14px
      );
      opacity: 0.36;
      z-index: 0;
    }

    body::after {
      content: "";
      position: fixed;
      inset: -20%;
      pointer-events: none;
      background:
        repeating-linear-gradient(
          180deg,
          rgba(0, 179, 255, 0.12) 0px,
          rgba(0, 179, 255, 0.12) 2px,
          transparent 2px,
          transparent 22px
        );
      filter: blur(0.2px);
      opacity: 0.08;
      animation: matrixDrift 9s linear infinite;
      z-index: 0;
    }

    .shell {
      width: min(80vw, 1600px);
      height: min(80dvh, 980px);
      margin: auto;
      padding: 0;
      display: grid;
      grid-template-columns: clamp(280px, 22vw, 360px) 1fr;
      grid-template-rows: auto 1fr;
      gap: 0;
      border-radius: 18px;
      background: linear-gradient(180deg, #0b0b0c 0%, #080809 50%, #060607 100%);
      border: 1px solid var(--line-strong);
      box-shadow:
        0 0 20px rgba(0, 170, 255, 0.25),
        0 0 56px rgba(0, 170, 255, 0.14),
        0 24px 44px rgba(0, 0, 0, 0.5);
      backdrop-filter: none;
      position: relative;
      z-index: 2;
      transform-style: flat;
      will-change: transform;
      animation: shellWobble 6.2s ease-in-out infinite;
    }

    .shell::before {
      content: none;
    }

    .sidebar {
      border-radius: 0 0 0 18px;
      padding: 1rem;
      background: linear-gradient(180deg, #0d0d0f 0%, #09090b 52%, #070709 100%);
      border-right: 1px solid var(--line);
      display: flex;
      flex-direction: column;
      gap: 0.9rem;
      min-height: 0;
    }

    .sidebar-bottom {
      margin-top: auto;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .sidebar-link-grid {
      border: 1px solid var(--line);
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.35);
      padding: 0.35rem;
      min-height: 88px;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 0.35rem;
      overflow: hidden;
    }

    .sidebar-link-btn {
      appearance: none;
      border: 1px solid var(--line);
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.35);
      padding: 0;
      width: 100%;
      aspect-ratio: 1 / 1;
      cursor: pointer;
      overflow: hidden;
      transition: border-color 160ms ease, transform 160ms ease;
    }

    .sidebar-link-btn:hover {
      border-color: var(--line-strong);
      transform: translateY(-1px);
    }

    .sidebar-link-btn:focus-visible {
      outline: 2px solid var(--line-strong);
      outline-offset: 2px;
    }

    .sidebar-link-btn.is-selected {
      border-color: #00e9ff;
      box-shadow:
        inset 0 0 0 2px rgba(0, 233, 255, 0.45),
        0 0 14px rgba(0, 233, 255, 0.45);
      background: linear-gradient(180deg, rgba(0, 233, 255, 0.16) 0%, rgba(0, 0, 0, 0.38) 100%);
    }

    .sidebar-link-img {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      image-rendering: pixelated;
      opacity: 0.94;
      filter: contrast(1.05);
    }

    .sidebar-link-img.is-grayscale {
      filter: grayscale(1) contrast(1.05);
    }

    html.invert-mode .sidebar-link-img.no-invert-img {
      filter: invert(1) hue-rotate(180deg) contrast(1.05);
    }

    html.invert-mode .sidebar-link-img.no-invert-img.is-grayscale {
      filter: invert(1) hue-rotate(180deg) grayscale(1) contrast(1.05);
    }

    .crt-ticker {
      height: 50px;
      border: 1px solid var(--line);
      border-radius: 12px;
      background: linear-gradient(180deg, rgba(0, 179, 255, 0.12) 0%, rgba(0, 0, 0, 0.55) 100%);
      overflow: hidden;
      position: relative;
      display: flex;
      align-items: center;
      box-shadow: inset 0 0 18px rgba(0, 179, 255, 0.08);
    }

    .crt-ticker::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: repeating-linear-gradient(
        0deg,
        rgba(255, 255, 255, 0.04) 0,
        rgba(255, 255, 255, 0.04) 1px,
        transparent 1px,
        transparent 3px
      );
      opacity: 0.35;
    }

    .crt-ticker-track {
      white-space: nowrap;
      display: flex;
      width: max-content;
      gap: 0;
      color: #ff003c;
      text-shadow:
        0 0 4px rgba(255, 0, 60, 0.55),
        0 0 8px rgba(255, 0, 60, 0.45),
        0 0 14px rgba(255, 0, 60, 0.3);
      font-size: 0.92rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding-left: 0;
      animation: tickerScroll 22s linear infinite;
      will-change: transform;
    }

    .crt-ticker-track span {
      flex: 0 0 auto;
      display: inline-block;
      padding-right: 3rem;
    }


    .brand {
      display: block;
      padding-bottom: 0.7rem;
      border-bottom: 1px solid var(--line);
    }

    .brand-mark {
      width: 100%;
    }

    .ascii-logo-img {
      display: block;
      width: 100%;
      height: 64px;
      margin-top: 8px;
      max-height: none;
      object-fit: cover;
      object-position: left center;
      image-rendering: auto;
    }

    .sidebar-card {
      border: 1px solid var(--line);
      border-radius: 14px;
      background: var(--panel-2);
      padding: 0.8rem;
    }

    .chip {
      border: 1px solid var(--line);
      background: rgba(0, 179, 255, 0.07);
      color: var(--text-1);
      border-radius: 999px;
      font-size: 0.75rem;
      padding: 0.35rem 0.7rem;
      transition: 180ms ease;
    }

    .chip:hover {
      border-color: rgba(0, 179, 255, 0.72);
      color: var(--text-0);
      transform: translateY(-1px);
    }

    select.chip {
      color: var(--text-0);
      background: rgba(0, 179, 255, 0.12);
    }

    select.chip option {
      color: #0b1526;
      background: #d7ebff;
    }

    select.chip option:checked {
      color: #ffffff;
      background: #1f6feb;
    }

    .main {
      border-radius: 0 0 18px 0;
      border-left: 1px solid var(--line);
      background: linear-gradient(180deg, #0d0d0f 0%, #09090b 55%, #070709 100%);
      display: grid;
      grid-template-rows: auto 1fr auto;
      min-height: 0;
      overflow: hidden;
    }

    .window-chrome {
      grid-column: 1 / -1;
      height: 42px;
      border-bottom: 1px solid var(--line);
      border-radius: 18px 18px 0 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 0.9rem;
      background: #000000;
    }

    .chrome-dots {
      display: flex;
      align-items: center;
      gap: 0.45rem;
    }

    .chrome-dot {
      width: 11px;
      height: 11px;
      border-radius: 50%;
      box-shadow: 0 0 8px currentColor;
    }

    .dot-red { color: #ff5f57; background: #ff5f57; }
    .dot-amber { color: #febc2e; background: #febc2e; }
    .dot-green { color: #28c840; background: #28c840; }

    .mode-toggle-dot {
      position: relative;
      border: 0;
      padding: 0;
      appearance: none;
      cursor: pointer;
    }

    .chrome-link-dot {
      position: relative;
      display: inline-block;
      border: 0;
      padding: 0;
      text-decoration: none;
      cursor: pointer;
    }

    .chrome-link-dot::before {
      content: attr(data-icon);
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      font-size: 8px;
      line-height: 1;
      color: #101010;
      opacity: 0;
      transform: scale(0.7);
      transition: opacity 120ms ease, transform 120ms ease;
      pointer-events: none;
      text-shadow: 0 0 2px rgba(255, 255, 255, 0.35);
    }

    .chrome-link-dot:hover::before,
    .chrome-link-dot:focus-visible::before {
      opacity: 1;
      transform: scale(1);
    }

    .mode-toggle-dot::before {
      content: "\2600";
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      font-size: 8px;
      line-height: 1;
      color: #ffe88b;
      opacity: 0;
      transform: scale(0.7);
      transition: opacity 120ms ease, transform 120ms ease;
      text-shadow: 0 0 3px rgba(255, 232, 139, 0.55);
      pointer-events: none;
    }

    .mode-toggle-dot:hover::before,
    .mode-toggle-dot:focus-visible::before {
      opacity: 1;
      transform: scale(1);
    }

    .chrome-title {
      font-size: 0.88rem;
      letter-spacing: 0.04em;
      color: var(--accent-a);
      text-shadow: 0 0 8px rgba(0, 170, 255, 0.35);
    }

    .topbar {
      padding: 0.95rem 1rem;
      border-bottom: 1px solid var(--line);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.7rem;
    }

    .ghost-btn {
      border: 1px solid var(--accent-a);
      background: transparent;
      color: #ffffff;
      border-radius: 10px;
      padding: 0.48rem 0.72rem;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      transition: 180ms ease;
      box-shadow: 0 0 0 1px rgba(255, 46, 201, 0.18), inset 0 0 8px rgba(255, 46, 201, 0.07);
    }

    .ghost-btn:hover {
      border-color: var(--accent-a);
      background: rgba(255, 255, 255, 0.04);
      color: #ffffff;
    }

    .ghost-btn svg,
    .ghost-btn i {
      color: var(--magenta) !important;
    }

    * {
      scrollbar-width: thin;
      scrollbar-color: rgba(0, 179, 255, 0.95) transparent;
    }

    *::-webkit-scrollbar {
      width: 12px;
      height: 12px;
      background: transparent;
    }

    *::-webkit-scrollbar-track {
      border: 1px solid rgba(0, 179, 255, 0.35);
      border-radius: 999px;
      background: transparent;
    }

    *::-webkit-scrollbar-thumb {
      border: 2px solid rgba(0, 179, 255, 0.95);
      border-radius: 999px;
      background: transparent !important;
      background-color: transparent !important;
      background-clip: padding-box;
      box-shadow: none;
    }

    *::-webkit-scrollbar-button {
      width: 0;
      height: 0;
      display: none;
      background: transparent;
    }

    .thread {
      overflow: auto;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.9rem;
    }

    .msg {
      width: 100%;
      max-width: 100%;
      border-radius: 16px;
      padding: 0.9rem 1rem;
      line-height: 1.45;
      animation: riseIn 220ms ease both;
      border: 1px solid var(--line);
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      -webkit-tap-highlight-color: transparent;
      transition: none;
      transform: translateZ(0);
      backface-visibility: hidden;
      will-change: border-color, outline-color;
    }

    .msg-user {
      width: auto;
      max-width: min(78%, 980px);
      margin-left: auto;
      background: rgba(180, 220, 255, 0.15);
      color: #ffffff;
      border-top-right-radius: 6px;
      box-shadow: 0 0 14px rgba(190, 230, 255, 0.14);
    }

    .msg-user,
    .msg-user * {
      color: #ffffff !important;
    }

    .msg-ai {
      background: rgba(0, 179, 255, 0.07);
      color: var(--cyan);
      border-top-left-radius: 6px;
    }

    .msg-selected {
      border: 1px solid rgba(255, 46, 201, 0.75) !important;
      outline: 1px solid rgba(255, 46, 201, 0.2);
      outline-offset: 0;
      box-shadow: none;
    }

    .idea-grid {
      margin-top: 0.65rem;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.55rem;
    }

    .idea-pill {
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 0.5rem;
      background: rgba(0, 179, 255, 0.05);
      font-size: 0.8rem;
      color: #ffffff;
    }

    .idea-pill strong {
      display: block;
      margin-bottom: 0.2rem;
      color: var(--cyan);
      font-size: 0.73rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .composer {
      padding: 0.9rem 1rem 1rem;
      border-top: 1px solid var(--line);
      background: rgba(1, 8, 18, 0.68);
    }

    .composer-wrap {
      border: 1px solid var(--line-strong);
      background: rgba(0, 179, 255, 0.06);
      border-radius: 14px;
      padding: 0.4rem;
      display: flex;
      align-items: center;
      gap: 0.45rem;
    }

    .composer-search-icon {
      margin-left: 0.2rem;
    }

    .composer-wrap input {
      flex: 1;
      border: 0;
      outline: 0;
      background: transparent;
      color: var(--text-0);
      font-family: "Share Tech Mono", monospace;
      font-size: 1rem;
      padding: 0.55rem 0.45rem;
    }

    .composer-wrap input::placeholder {
      color: #ffffff;
    }

    .send-btn {
      width: 38px;
      height: 38px;
      border-radius: 10px;
      border: 1px solid #ffe35a !important;
      background: linear-gradient(140deg, rgba(255, 227, 90, 0.15) 0%, rgba(255, 190, 30, 0.24) 100%) !important;
      color: #fffbe2 !important;
      display: grid;
      place-items: center;
      transition: 180ms ease;
      box-shadow:
        inset 0 0 8px rgba(120, 90, 0, 0.22),
        0 0 4px rgba(255, 227, 90, 0.45),
        0 0 8px rgba(255, 227, 90, 0.35),
        0 0 14px rgba(255, 227, 90, 0.2) !important;
    }

    .send-btn svg,
    .send-btn i {
      color: #fffbe2 !important;
      stroke: currentColor !important;
    }

    .send-btn:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
    }

    .mini-history {
      overflow: auto;
      min-height: 0;
      display: flex;
      flex-direction: column;
      gap: 0.55rem;
    }

    .history-item {
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 0.58rem;
      background: rgba(0, 179, 255, 0.04);
      cursor: pointer;
      transition: 160ms ease;
    }

    .history-item:hover {
      border-color: rgba(0, 179, 255, 0.8);
      transform: translateY(-1px);
    }

    .truncate-two {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .muted {
      color: #ffffff;
      font-size: 0.8rem;
    }

    @keyframes riseIn {
      from {
        opacity: 0;
        transform: translateY(8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes shellWobble {
      0% { transform: rotate(-0.35deg) translateY(-1px); }
      50% { transform: rotate(0.35deg) translateY(1px); }
      100% { transform: rotate(-0.35deg) translateY(-1px); }
    }

    @keyframes matrixDrift {
      from { transform: translateY(-12%); }
      to { transform: translateY(12%); }
    }

    @keyframes tickerScroll {
      from { transform: translateX(0); }
      to { transform: translateX(-50%); }
    }

    .text-slate-100,
    .text-slate-200,
    .text-slate-400,
    .text-slate-500 {
      color: var(--text-1) !important;
    }

    .font-medium,
    .font-semibold {
      text-shadow: 0 0 8px rgba(70, 190, 255, 0.28);
    }

    .msg-ai p {
      color: #ffffff;
    }

    .msg-ai p.font-semibold,
    .msg-ai p.font-medium,
    .msg-ai .idea-pill strong {
      color: var(--cyan);
    }

    .msg-ai .muted {
      color: #ffffff !important;
      text-shadow: none;
    }

    .msg-user {
      color: #ffffff;
    }

    #saved-list .muted {
      color: #ffffff;
      text-shadow: none;
    }

    .saved-heading {
      color: #ffe35a !important;
    }

    .idea-note {
      color: #ffe35a !important;
      text-shadow: 0 0 8px rgba(255, 227, 90, 0.26);
    }

    .msg-ai .idea-note {
      color: #ffe35a !important;
      text-shadow: 0 0 8px rgba(255, 227, 90, 0.26);
    }

    .empty-note {
      color: #ffffff !important;
      text-shadow: none;
    }

    #toast {
      color: var(--magenta) !important;
      background: #000000 !important;
      border-color: rgba(0, 179, 255, 0.65) !important;
      box-shadow: 0 0 18px rgba(0, 179, 255, 0.24);
    }

    @media (max-width: 980px) {
      body {
        overflow: auto;
        display: block;
        overflow-x: hidden;
        -webkit-text-size-adjust: 100%;
        text-size-adjust: 100%;
      }

      .shell {
        width: 100%;
        max-width: 100vw;
        height: auto;
        min-height: 100dvh;
        margin: 0;
        padding: 0;
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto;
        border-radius: 0;
        animation: none;
      }

      .sidebar {
        order: 2;
        border-right: none;
        border-top: 1px solid var(--line);
        border-radius: 0;
      }

      .main {
        order: 1;
        min-height: 70vh;
        border-left: none;
        border-radius: 0;
      }

      .window-chrome {
        height: 36px;
        padding: 0 0.65rem;
        border-radius: 0;
      }

      .chrome-title {
        flex: 1;
        min-width: 0;
        font-size: 0.72rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        text-align: center;
        padding: 0 0.45rem;
      }

      .topbar {
        flex-direction: column;
        align-items: flex-start;
      }

      .topbar > div:last-child {
        width: 100%;
        display: flex;
        flex-wrap: wrap;
      }

      .idea-grid {
        grid-template-columns: 1fr;
      }

      .msg-user {
        max-width: 100%;
      }

      .thread,
      .composer {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
      }

      .composer-wrap input {
        font-size: 16px;
      }

      .sidebar-bottom {
        margin-top: 0.3rem;
      }

      .sidebar-link-grid {
        min-height: 74px;
      }

      .crt-ticker {
        height: 46px;
      }

      .crt-ticker-track {
        font-size: 0.74rem;
      }
    }

    @media (max-width: 640px) {
      .sidebar {
        padding: 0.75rem;
      }

      .sidebar-card {
        padding: 0.7rem;
      }

      .ghost-btn {
        min-height: 36px;
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .shell,
      body::after {
        animation: none;
      }
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="window-chrome">
      <div class="chrome-dots">
        <button id="mode-toggle-btn" class="chrome-dot dot-red mode-toggle-dot" type="button" aria-label="Toggle light mode" aria-pressed="false"></button>
        <a class="chrome-dot dot-amber chrome-link-dot" data-icon="X" href="https://x.com/chadswtf" target="_blank" rel="noopener noreferrer" aria-label="Open X profile"></a>
        <a class="chrome-dot dot-green chrome-link-dot" data-icon="T" href="https://chads.wtf" target="_blank" rel="noopener noreferrer" aria-label="Open Telegram profile"></a>
      </div>
      <div class="chrome-title">retard@wizardchad:~</div>
      <div></div>
    </div>

    <aside class="sidebar">
      <div class="brand">
        <div class="brand-mark">
          <p class="text-[0.65rem] tracking-[0.14em] text-slate-400 uppercase">BETA(ALPHA) v1.0</p>
          <img class="ascii-logo-img" src="./assets/images/ascii-art-text1.png" alt="VibeCHAD ASCII logo" />
        </div>
      </div>

      <div class="sidebar-card">
        <p class="text-sm text-slate-200 font-medium">Convert files in one click</p>
        <p class="muted mt-1">Upload any file, choose the target format, and convert it instantly in-browser. Text and image formats are converted directly.</p>
        <div class="mt-3 flex flex-wrap gap-2">
          <button class="chip" onclick="setTargetFormat('pdf')">to PDF</button>
          <button class="chip" onclick="setTargetFormat('txt')">to TXT</button>
          <button class="chip" onclick="setTargetFormat('json')">to JSON</button>
          <button class="chip" onclick="setTargetFormat('png')">to PNG</button>
        </div>
      </div>

      <div class="flex items-center justify-between pt-1">
        <p class="text-sm font-medium text-slate-200 saved-heading">Recent outputs</p>
        <button class="ghost-btn text-xs px-2 py-1" onclick="clearHistory()">
          <i data-lucide="trash-2" class="w-3.5 h-3.5"></i>
          Clear
        </button>
      </div>

      <div id="saved-list" class="mini-history custom-scroll">
        <p class="muted empty-note">No converted files yet.</p>
      </div>

      <div class="sidebar-bottom">
        <div class="sidebar-link-grid">
          <button class="sidebar-link-btn" type="button" aria-label="Pirate Chad button" onclick="window.location.href='./pirate_chad_v1.html'">
            <img class="sidebar-link-img no-invert-img is-grayscale" src="./assets/images/pirate-chad.png" alt="Pirate Chad" />
          </button>
          <button class="sidebar-link-btn is-selected" type="button" aria-label="Wizard Chad button" aria-current="page">
            <img class="sidebar-link-img no-invert-img" src="./assets/images/wizard-chad.png" alt="Wizard Chad" />
          </button>
          <button class="sidebar-link-btn" type="button" aria-label="Green Chad button" onclick="window.location.href='./encrypt_chad_v1.html'">
            <img class="sidebar-link-img no-invert-img is-grayscale" src="./assets/images/green-chad.png" alt="Green Chad" />
          </button>
        </div>
        <div class="crt-ticker" aria-hidden="true">
          <div class="crt-ticker-track">
            <span>WE WILL TAKE ANTARCTICA WITH ZERO RESISTANCE AND BUILD THE NEW WORLD IN THE SUB-TERRIAN CLIMATE UNDER THE ICE</span>
            <span>WE WILL TAKE ANTARCTICA WITH ZERO RESISTANCE AND BUILD THE NEW WORLD IN THE SUB-TERRIAN CLIMATE UNDER THE ICE</span>
          </div>
        </div>
      </div>

    </aside>

    <section class="main">
      <div class="topbar">
        <div>
          <p class="font-medium tracking-[0.16em]">WizardCHAD™ File Converter</p>
          <p class="text-sm text-slate-200">Drop in a file, choose output type, and download the converted result.</p>
        </div>
        <div class="flex items-center gap-2">
          <button class="ghost-btn" onclick="triggerFilePicker()">
            <i data-lucide="upload" class="w-4 h-4"></i>
            Pick File
          </button>
          <button class="ghost-btn" onclick="convertNow()">
            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
            Convert
          </button>
          <button class="ghost-btn" onclick="downloadLatest()">
            <i data-lucide="download" class="w-4 h-4"></i>
            Download
          </button>
        </div>
      </div>

      <div id="thread" class="thread custom-scroll">
        <div class="msg msg-ai">
          <p class="font-medium">Use the input bar below to upload a file, choose a target type, then click convert.</p>
          <p class="muted mt-1">Converted outputs appear here and in the 'Recent outputs' panel for quick download.</p>
        </div>
      </div>

      <div class="composer">
        <form id="converter-form" class="composer-wrap">
          <i data-lucide="paperclip" class="w-4 h-4 text-slate-400 composer-search-icon"></i>
          <input id="file-input" type="file" />
          <select id="format-select" class="chip" aria-label="Select target format">
            <option value="txt">TXT</option>
            <option value="pdf">PDF</option>
            <option value="json">JSON</option>
            <option value="csv">CSV</option>
            <option value="md">MD</option>
            <option value="html">HTML</option>
            <option value="xml">XML</option>
            <option value="png">PNG</option>
            <option value="jpg">JPG</option>
            <option value="webp">WEBP</option>
            <option value="zip">ZIP</option>
          </select>
          <button type="submit" class="send-btn" aria-label="Convert file">
            <i data-lucide="arrow-up" class="w-4 h-4"></i>
          </button>
        </form>
      </div>
    </section>
  </div>

  <div id="toast" class="fixed bottom-5 right-5 rounded-xl border border-white/20 bg-slate-900/90 px-4 py-2 text-sm text-slate-100 opacity-0 translate-y-3 transition-all duration-300 pointer-events-none"></div>

  <script>
    const thread = document.getElementById("thread");
    const fileInput = document.getElementById("file-input");
    const formatSelect = document.getElementById("format-select");
    const converterForm = document.getElementById("converter-form");
    const savedList = document.getElementById("saved-list");
    const toast = document.getElementById("toast");
    const modeToggleBtn = document.getElementById("mode-toggle-btn");

    const MODE_STORAGE_KEY = "vibechad_invert_mode";
    const WIZARD_HISTORY_STORAGE_KEY = "vibechad_wizard_history_v1";
    const recentOutputs = [];
    let latestOutput = null;

    const MIME_BY_EXT = {
      txt: "text/plain",
      md: "text/markdown",
      csv: "text/csv",
      json: "application/json",
      html: "text/html",
      xml: "application/xml",
      pdf: "application/pdf",
      png: "image/png",
      jpg: "image/jpeg",
      jpeg: "image/jpeg",
      webp: "image/webp",
      zip: "application/zip"
    };

    const TEXT_EXTENSIONS = new Set(["txt", "md", "csv", "json", "html", "xml", "js", "css", "ts", "yaml", "yml", "log"]);
    const IMAGE_EXTENSIONS = new Set(["png", "jpg", "jpeg", "webp"]);

    document.addEventListener("DOMContentLoaded", () => {
      lucide.createIcons();

      const savedMode = localStorage.getItem(MODE_STORAGE_KEY);
      const shouldInvert = savedMode === "1";
      document.documentElement.classList.toggle("invert-mode", shouldInvert);
      modeToggleBtn.setAttribute("aria-pressed", shouldInvert ? "true" : "false");

      modeToggleBtn.addEventListener("click", () => {
        document.documentElement.classList.toggle("invert-mode");
        const isOn = document.documentElement.classList.contains("invert-mode");
        modeToggleBtn.setAttribute("aria-pressed", isOn ? "true" : "false");
        localStorage.setItem(MODE_STORAGE_KEY, isOn ? "1" : "0");
      });

      hydrateHistory();
      renderHistory();

      converterForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        await convertNow();
      });
    });

    function triggerFilePicker() {
      fileInput.click();
    }

    function setTargetFormat(format) {
      formatSelect.value = format;
      showToast(`Target format set to ${format.toUpperCase()}.`);
    }

    function clearHistory() {
      recentOutputs.forEach((item) => URL.revokeObjectURL(item.url));
      recentOutputs.length = 0;
      latestOutput = null;
      persistHistory();
      renderHistory();
      showToast("History cleared.");
    }

    function downloadLatest() {
      if (!latestOutput) {
        showToast("No converted file yet.");
        return;
      }

      downloadFile(latestOutput.url, latestOutput.name);
      showToast("Downloaded latest file.");
    }

    async function convertNow() {
      const file = fileInput.files && fileInput.files[0];
      if (!file) {
        showToast("Pick a file first.");
        return;
      }

      const targetExt = formatSelect.value.toLowerCase();
      appendUserMessage(`${file.name} -> ${targetExt.toUpperCase()}`);

      try {
        const result = await convertFile(file, targetExt);
        const outputDataUrl = await blobToDataUrl(result.blob);
        const outputUrl = URL.createObjectURL(result.blob);
        const record = {
          name: result.name,
          inputName: file.name,
          targetExt,
          note: result.note,
          dataUrl: outputDataUrl,
          url: outputUrl,
          time: new Date().toLocaleTimeString()
        };

        latestOutput = record;
        recentOutputs.unshift(record);
        if (recentOutputs.length > 25) {
          const dropped = recentOutputs.pop();
          URL.revokeObjectURL(dropped.url);
        }

        persistHistory();
        appendOutputMessage(record);
        renderHistory();
        showToast("File converted.");
      } catch (error) {
        showToast(`Convert failed: ${error.message}`);
      }
    }

    async function convertFile(file, targetExt) {
      const sourceExt = getExtension(file.name);
      const baseName = stripExtension(file.name);
      const outputName = `${baseName}.${targetExt}`;

      if (IMAGE_EXTENSIONS.has(sourceExt) && IMAGE_EXTENSIONS.has(targetExt)) {
        const imageBlob = await convertImage(file, targetExt);
        return {
          blob: imageBlob,
          name: outputName,
          note: "Image transcoded in-browser."
        };
      }

      if (TEXT_EXTENSIONS.has(sourceExt) || file.type.startsWith("text/")) {
        const text = await file.text();
        const convertedText = convertTextContent(text, sourceExt, targetExt);
        return {
          blob: new Blob([convertedText], { type: MIME_BY_EXT[targetExt] || "text/plain" }),
          name: outputName,
          note: "Text conversion complete."
        };
      }

      const bytes = await file.arrayBuffer();
      return {
        blob: new Blob([bytes], { type: MIME_BY_EXT[targetExt] || file.type || "application/octet-stream" }),
        name: outputName,
        note: "Binary repack complete (extension changed)."
      };
    }

    function convertTextContent(inputText, sourceExt, targetExt) {
      if (targetExt === "json") {
        try {
          const parsed = JSON.parse(inputText);
          return JSON.stringify(parsed, null, 2);
        } catch {
          return JSON.stringify({ source: sourceExt || "unknown", content: inputText }, null, 2);
        }
      }

      if (targetExt === "csv") {
        try {
          const parsed = JSON.parse(inputText);
          return toCsv(parsed);
        } catch {
          return `content\n"${inputText.replace(/"/g, '""').replace(/\r?\n/g, " ")}"`;
        }
      }

      if (targetExt === "xml") {
        const escaped = inputText
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
        return `<document><content>${escaped}</content></document>`;
      }

      if (targetExt === "html") {
        const escaped = inputText
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
        return `<!doctype html><html><body><pre>${escaped}</pre></body></html>`;
      }

      return inputText;
    }

    function toCsv(value) {
      const rows = Array.isArray(value) ? value : [value];
      const objects = rows.filter((item) => item && typeof item === "object" && !Array.isArray(item));
      if (!objects.length) return `value\n"${JSON.stringify(value).replace(/"/g, '""')}"`;

      const headers = Array.from(new Set(objects.flatMap((item) => Object.keys(item))));
      const lines = [headers.join(",")];

      objects.forEach((item) => {
        const line = headers
          .map((header) => {
            const raw = item[header] == null ? "" : String(item[header]);
            return `"${raw.replace(/"/g, '""')}"`;
          })
          .join(",");
        lines.push(line);
      });

      return lines.join("\n");
    }

    async function convertImage(file, targetExt) {
      const dataUrl = await readAsDataUrl(file);
      const img = await loadImage(dataUrl);
      const canvas = document.createElement("canvas");
      canvas.width = img.naturalWidth;
      canvas.height = img.naturalHeight;

      const ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0);

      const mime = MIME_BY_EXT[targetExt] || "image/png";
      const blob = await new Promise((resolve) => canvas.toBlob(resolve, mime, 0.92));
      if (!blob) {
        throw new Error("Image codec not available.");
      }

      return blob;
    }

    function readAsDataUrl(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = () => reject(new Error("Could not read file."));
        reader.readAsDataURL(file);
      });
    }

    function loadImage(src) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.onerror = () => reject(new Error("Could not decode image."));
        img.src = src;
      });
    }

    function appendUserMessage(text) {
      const user = document.createElement("div");
      user.className = "msg msg-user";
      user.textContent = text;
      thread.appendChild(user);
      thread.scrollTop = thread.scrollHeight;
    }

    function appendOutputMessage(record) {
      const msg = document.createElement("div");
      msg.className = "msg msg-ai";
      msg.innerHTML = `
        <p class="font-semibold text-lg">Converted: ${escapeHtml(record.name)}</p>
        <p class="mt-1">Source: ${escapeHtml(record.inputName)} | Format: ${escapeHtml(record.targetExt.toUpperCase())}</p>
        <p class="muted mt-2 idea-note">${escapeHtml(record.note)}</p>
        <div class="mt-3">
          <a class="ghost-btn" href="${record.url}" download="${escapeHtml(record.name)}">Download file</a>
        </div>
      `;

      thread.appendChild(msg);
      thread.scrollTop = thread.scrollHeight;
    }

    function renderHistory() {
      if (!recentOutputs.length) {
        savedList.innerHTML = '<p class="muted empty-note">No converted files yet.</p>';
        return;
      }

      savedList.innerHTML = recentOutputs
        .map((file, index) => `
          <button class="history-item text-left" onclick="downloadFromHistory(${index})">
            <p class="text-sm font-medium mt-0.5" style="color: var(--cyan);">${escapeHtml(file.name)}</p>
            <p class="text-xs mt-1 truncate-two" style="color: #ffffff;">From: ${escapeHtml(file.inputName)}</p>
            <p class="text-[0.68rem] uppercase tracking-[0.08em] mt-2" style="color: var(--magenta);">${escapeHtml(file.time)}</p>
          </button>
        `)
        .join("");
    }

    function downloadFromHistory(index) {
      const item = recentOutputs[index];
      if (!item) return;
      if (!item.url && item.dataUrl) {
        item.url = URL.createObjectURL(dataUrlToBlob(item.dataUrl));
      }
      if (!item.url) {
        showToast("File data missing.");
        return;
      }
      downloadFile(item.url, item.name);
      showToast("Downloaded from history.");
    }

    function persistHistory() {
      try {
        const serializable = recentOutputs.slice(0, 25).map((item) => ({
          name: item.name,
          inputName: item.inputName,
          targetExt: item.targetExt,
          note: item.note,
          dataUrl: item.dataUrl,
          time: item.time
        }));
        localStorage.setItem(WIZARD_HISTORY_STORAGE_KEY, JSON.stringify(serializable));
      } catch {
      }
    }

    function hydrateHistory() {
      try {
        const raw = localStorage.getItem(WIZARD_HISTORY_STORAGE_KEY);
        if (!raw) return;
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return;

        recentOutputs.length = 0;
        parsed.slice(0, 25).forEach((item) => {
          if (!item || typeof item !== "object") return;
          const dataUrl = String(item.dataUrl || "");
          const name = String(item.name || "").trim();
          if (!dataUrl || !name) return;
          const blob = dataUrlToBlob(dataUrl);
          const url = URL.createObjectURL(blob);
          recentOutputs.push({
            name,
            inputName: String(item.inputName || "unknown"),
            targetExt: String(item.targetExt || ""),
            note: String(item.note || ""),
            dataUrl,
            url,
            time: String(item.time || "")
          });
        });
        latestOutput = recentOutputs[0] || null;
      } catch {
      }
    }

    function downloadFile(url, name) {
      const a = document.createElement("a");
      a.href = url;
      a.download = name;
      document.body.appendChild(a);
      a.click();
      a.remove();
    }

    function blobToDataUrl(blob) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(String(reader.result || ""));
        reader.onerror = () => reject(new Error("Could not encode file data."));
        reader.readAsDataURL(blob);
      });
    }

    function dataUrlToBlob(dataUrl) {
      const [meta, base64] = String(dataUrl).split(",");
      const mimeMatch = /^data:([^;]+);base64$/i.exec(meta || "");
      const mime = mimeMatch ? mimeMatch[1] : "application/octet-stream";
      const binary = atob(base64 || "");
      const bytes = new Uint8Array(binary.length);
      for (let i = 0; i < binary.length; i += 1) {
        bytes[i] = binary.charCodeAt(i);
      }
      return new Blob([bytes], { type: mime });
    }

    function stripExtension(filename) {
      const index = filename.lastIndexOf(".");
      return index > 0 ? filename.slice(0, index) : filename;
    }

    function getExtension(filename) {
      const index = filename.lastIndexOf(".");
      return index > -1 ? filename.slice(index + 1).toLowerCase() : "";
    }

    function showToast(message) {
      toast.textContent = message;
      toast.classList.remove("opacity-0", "translate-y-3");
      setTimeout(() => {
        toast.classList.add("opacity-0", "translate-y-3");
      }, 1700);
    }

    function escapeHtml(input) {
      const div = document.createElement("div");
      div.textContent = String(input);
      return div.innerHTML;
    }
  </script>
</body>
</html>



